<!DOCTYPE html>
<html lang="zh-CN">
<head>

 <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
  <title>EPhone PWA</title>
  
  <!-- PWA 设置 -->
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EPhone">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg">
  <meta name="theme-color" content="#f0f2f5">
    
    <style>
        :root {
            --screen-width: 350px;
            --screen-height: 650px;
            --border-color: #e0e0e0;
            --text-primary: #1f1f1f;
        }

          html {
            -webkit-text-size-adjust: 100%;
            height: 100%; 
        }
        body {
            margin: 0;
            font-family: 'bulangni', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-weight: normal;
            background-color: #f0f2f5;
            height: 100%; 
            overflow: hidden; 
        }

        /* --- 手机屏幕容器 --- */
        #phone-screen {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #6DD5FA, #2980B9);
            background-size: cover;
            background-position: center;
        }

        /* --- 屏幕通用 --- */
        .screen {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s;
            z-index: 10; /* 确保主屏幕层级 */
        }

        /* --- 主屏幕布局 --- */
        #home-screen {
            padding-top: calc(20px + env(safe-area-inset-top));
            padding-bottom: 20px;
            box-sizing: border-box;
        }

        #home-screen-pages-container {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        #home-screen-pages {
            width: 100%;
            height: 100%;
            display: flex;
        }

        .home-screen-page {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
        }

        #main-content-area {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* --- 桌面图标样式 --- */
        #desktop-layout {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 0 20px;
            box-sizing: border-box;
        }

        #desktop-app-container {
            display: flex;
            gap: 30px;
        }

        .desktop-app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            text-align: center;
            width: 60px;
            -webkit-tap-highlight-color: transparent;
        }

        .icon-bg-desktop {
            width: 60px;
            height: 60px;
            border-radius: 14px;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.1s ease;
        }

        .icon-bg-desktop img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .desktop-app-icon .label {
            color: white;
            font-size: 13px;
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .desktop-app-icon:active .icon-bg-desktop {
            transform: scale(0.9);
            filter: brightness(0.8);
        }

        /* --- App 容器样式 (关键修改点) --- */
        .app-window {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: #fff; 
            z-index: 50; 
            
            /* 修改部分：始终 display: flex，但通过 visibility 隐藏 */
            display: flex; 
            flex-direction: column;
            padding: 0;
            box-sizing: border-box;
            
            /* 默认隐藏状态 */
            opacity: 0;
            visibility: hidden; 
            pointer-events: none; /* 隐藏时不响应点击，穿透到桌面 */
            transform: scale(0.9);
            
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0s linear 0.3s; /* visibility 延迟变化 */
        }

        .app-window.active {
            /* 激活状态 */
            opacity: 1;
            visibility: visible;
            pointer-events: auto; /* 激活时恢复点击 */
            transform: scale(1);
            transition: transform 0.3s ease, opacity 0.3s ease, visibility 0s linear 0s; /* 立即显示 */
        }

        /* Iframe 样式 */
        .app-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            background-color: #fff;
        }

        /* 悬浮按钮 (Assistive Touch) */
        #floating-btn {
            width: 50px;
            height: 50px;
            background: rgba(50, 50, 50, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 14px; 
            position: absolute;
            top: 60%;
            right: 20px;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
            cursor: move;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s;
        }

        #floating-btn::after {
            content: '';
            width: 26px;
            height: 26px;
            background-color: rgba(255,255,255,0.9);
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        #floating-btn:active {
            background: rgba(50, 50, 50, 0.8);
        }

    </style>
</head>
<body>

<div id="phone-screen">
    
    <!-- 主屏幕 (Home Screen) -->
    <div id="home-screen" class="screen">
      <div id="home-screen-pages-container">
        <div id="home-screen-pages">
          <div class="home-screen-page">
            <div id="main-content-area">
              
              <!-- 桌面布局 -->
              <div id="desktop-layout">
                <div id="desktop-app-container">
                  
                  <!-- App A 入口 -->
                  <div class="desktop-app-icon" onclick="openApp('a')">
                    <div class="icon-bg-desktop">
                      <!-- 替换成你的图标 -->
                      <img src="https://via.placeholder.com/100/007bff/ffffff?text=A" alt="App A">
                    </div> 
                    <span class="label">Github A</span>
                  </div>

                  <!-- App B 入口 -->
                  <div class="desktop-app-icon" onclick="openApp('b')">
                    <div class="icon-bg-desktop">
                      <!-- 替换成你的图标 -->
                      <img src="https://via.placeholder.com/100/28a745/ffffff?text=B" alt="App B">
                    </div> 
                    <span class="label">Github B</span>
                  </div>

                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- App A 页面 -->
    <!-- 注意：iframe 一开始就会加载，这是数据不丢失的关键 -->
    <div id="app-a" class="app-window">
        <!-- 请在这里替换成你的第一个 Github 链接 -->
        <iframe src="https://cx3300-1.github.io/ooooka/" class="app-iframe" title="App A"></iframe>
    </div>

    <!-- App B 页面 -->
    <div id="app-b" class="app-window">
        <!-- 请在这里替换成你的第二个 Github 链接 -->
        <iframe src="https://cx3300-1.github.io/sfsfdf/" class="app-iframe" title="App B"></iframe>
    </div>

    <!-- 悬浮按钮 -->
    <div id="floating-btn"></div>

</div>

<script>
    // --- App 切换逻辑 (已优化：去掉了 display 切换，只用 class) ---
    const homeScreen = document.getElementById('home-screen');
    const appA = document.getElementById('app-a');
    const appB = document.getElementById('app-b');
    let currentApp = null; 

    function openApp(appId) {
        let activeApp;
        
        // 确保先关闭所有应用（虽然通常只有一个）
        appA.classList.remove('active');
        appB.classList.remove('active');

        if (appId === 'a') {
            activeApp = appA;
            currentApp = 'a';
        } else if (appId === 'b') {
            activeApp = appB;
            currentApp = 'b';
        }

        if (activeApp) {
            // 直接添加 class，不再操作 style.display
            activeApp.classList.add('active');
            
            // 主屏幕缩小并变透明
            homeScreen.style.transform = 'scale(0.95)';
            homeScreen.style.opacity = '0';
            homeScreen.style.pointerEvents = 'none'; // 桌面不可点
        }
    }

    function goHome() {
        if (!currentApp) return; 

        // 移除 active class，App 会缩放淡出但不会销毁
        appA.classList.remove('active');
        appB.classList.remove('active');

        // 恢复主屏幕
        homeScreen.style.transform = 'scale(1)';
        homeScreen.style.opacity = '1';
        homeScreen.style.pointerEvents = 'auto'; // 桌面恢复可点
        
        currentApp = null;
    }

    // --- 悬浮按钮逻辑 (保留原样) ---
    const floatBtn = document.getElementById('floating-btn');
    let isDragging = false;
    let startX, startY, initialLeft, initialTop;
    let moveThreshold = 0; 

    function dragStart(e) {
        isDragging = false;
        moveThreshold = 0;
        
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

        startX = clientX;
        startY = clientY;
        
        const rect = floatBtn.getBoundingClientRect();
        const parentRect = document.getElementById('phone-screen').getBoundingClientRect();
        initialLeft = rect.left - parentRect.left;
        initialTop = rect.top - parentRect.top;

        if (e.type === 'touchstart') {
            document.addEventListener('touchmove', dragMove, { passive: false });
            document.addEventListener('touchend', dragEnd);
        } else {
            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
        }
    }

    function dragMove(e) {
        e.preventDefault(); 
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

        const dx = clientX - startX;
        const dy = clientY - startY;
        
        moveThreshold += Math.abs(dx) + Math.abs(dy);
        if (moveThreshold > 5) isDragging = true;

        floatBtn.style.left = `${initialLeft + dx}px`;
        floatBtn.style.top = `${initialTop + dy}px`;
        floatBtn.style.right = 'auto'; 
    }

    function dragEnd() {
        document.removeEventListener('touchmove', dragMove);
        document.removeEventListener('touchend', dragEnd);
        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('mouseup', dragEnd);

        if (!isDragging) {
            handleBtnClick();
        } else {
            snapToEdge();
        }
    }

    function snapToEdge() {
        const phoneScreen = document.getElementById('phone-screen');
        const screenWidth = phoneScreen.clientWidth;
        const screenHeight = phoneScreen.clientHeight;
        
        let currentLeft = parseFloat(floatBtn.style.left);
        if (isNaN(currentLeft)) currentLeft = floatBtn.offsetLeft;
        
        let currentTop = parseFloat(floatBtn.style.top);
        if (isNaN(currentTop)) currentTop = floatBtn.offsetTop;

        const btnWidth = floatBtn.offsetWidth;

        floatBtn.style.transition = 'all 0.3s ease';
        
        if (currentLeft + btnWidth / 2 < screenWidth / 2) {
            floatBtn.style.left = '10px';
        } else {
            floatBtn.style.left = (screenWidth - btnWidth - 10) + 'px';
        }

        if (currentTop < 50) floatBtn.style.top = '50px';
        if (currentTop > screenHeight - 80) floatBtn.style.top = (screenHeight - 80) + 'px';

        setTimeout(() => {
            floatBtn.style.transition = 'opacity 0.3s';
        }, 300);
    }

    function handleBtnClick() {
        if (navigator.vibrate) navigator.vibrate(50);

        if (currentApp) {
            goHome();
        } else {
            floatBtn.style.transform = 'scale(0.8)';
            setTimeout(() => floatBtn.style.transform = 'scale(1)', 100);
        }
    }

    floatBtn.addEventListener('mousedown', dragStart);
    floatBtn.addEventListener('touchstart', dragStart, { passive: false });
</script>
</body>
</html>
