<!DOCTYPE html>
<html lang="zh-CN">
<head>

 <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>EPhone</title>
  <link rel="stylesheet" href="style.css">
  <link rel="apple-touch-icon" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1758510900942_qdqqd_djw0z2.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="EPhone">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" type="image/png" href="https://s3plus.meituan.net/opapisdk/op_ticket_885190757_1756312261242_qdqqd_g0eriz.jpeg">
  <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f0f2f5">
    <title>PWA Demo</title>
    <style>
        /* --- 你的原始 CSS (保持不变) --- */
        :root {
            --screen-width: 350px;
            --screen-height: 650px;
            --border-color: #e0e0e0;
            --text-primary: #1f1f1f;
        }

          html {
            -webkit-text-size-adjust: 100%;
            height: 100%; 
        }
        body {
            margin: 0;
            font-family: 'bulangni', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-weight: normal;
            background-color: #f0f2f5;
            height: 100%; 
            overflow: hidden; 
        }

     #home-screen {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            box-sizing: border-box;
            background-size: cover;
            background-position: center;
            padding-left: 20px;
            padding-right: 20px;
        }

        /* --- 手机屏幕容器 --- */
        #phone-screen {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #6DD5FA, #2980B9);
            background-size: cover;
            background-position: center;
        }

        /* --- 状态栏 --- */
        #status-bar {
            padding: 0 20px;
            height: 44px;
            width: 100%;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            box-sizing: border-box;
            z-index: 200; /* 提高层级，确保在App之上 */
            text-shadow: 0 1px 3px rgba(0,0,0,0.4);
            font-size: 14px;
            font-weight: 600;
            pointer-events: none; /* 让点击穿透状态栏 */
        }

        .battery-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .battery-icon {
            width: 25px;
            height: 12px;
            border: 1px solid white;
            border-radius: 3px;
            position: relative;
            padding: 1px;
        }

        .battery-icon::after {
            content: '';
            position: absolute;
            right: -3px;
            top: 3px;
            width: 2px;
            height: 6px;
            background-color: white;
            border-radius: 0 1px 1px 0;
        }

        .battery-level {
            height: 100%;
            background-color: white;
            border-radius: 1px;
        }

        /* --- 屏幕通用 --- */
        .screen {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s;
        }

        /* --- 主屏幕布局 --- */
        #home-screen {
            padding-top: calc(44px + env(safe-area-inset-top));
            padding-bottom: 20px;
            box-sizing: border-box;
            z-index: 10;
        }

        #home-screen-pages-container {
            flex-grow: 1;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        #home-screen-pages {
            width: 100%;
            height: 100%;
            display: flex;
        }

        .home-screen-page {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
        }

        #main-content-area {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* --- 桌面图标样式 --- */
        #desktop-layout {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 0 20px;
            box-sizing: border-box;
        }

        #desktop-app-container {
            display: flex;
            gap: 30px;
        }

        .desktop-app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            text-align: center;
            width: 60px;
            -webkit-tap-highlight-color: transparent;
        }

        .icon-bg-desktop {
            width: 60px;
            height: 60px;
            border-radius: 14px;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.1s ease;
        }

        .icon-bg-desktop img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .desktop-app-icon .label {
            color: white;
            font-size: 13px;
            font-weight: 500;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }

        .desktop-app-icon:active .icon-bg-desktop {
            transform: scale(0.9);
            filter: brightness(0.8);
        }

        /* =========================================
           新增功能样式 (App视图 & 悬浮按钮)
           ========================================= */

        /* App 容器样式 */
        .app-window {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: #fff;
            z-index: 50; /* 比主屏幕高 */
            display: none; /* 默认隐藏 */
            flex-direction: column;
            padding-top: calc(44px + env(safe-area-inset-top)); /* 避开状态栏 */
            box-sizing: border-box;
            
            /* 简单的进入动画 */
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .app-window.active {
            display: flex;
            transform: scale(1);
            opacity: 1;
        }

        .app-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .app-header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* 悬浮按钮 (Assistive Touch) */
        #floating-btn {
            width: 50px;
            height: 50px;
            background: rgba(50, 50, 50, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 14px; /* iOS 风格 */
            position: absolute;
            top: 60%;
            right: 20px;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.2);
            cursor: move;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s;
        }

        #floating-btn::after {
            content: '';
            width: 26px;
            height: 26px;
            background-color: rgba(255,255,255,0.9);
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        #floating-btn:active {
            background: rgba(50, 50, 50, 0.8);
        }

    </style>
</head>
<body>

<div id="phone-screen">
    
    <!-- 状态栏 -->
    <div id="status-bar"> 
      <span id="status-bar-time">12:00</span>
      <div id="status-bar-battery" class="battery-container"> 
        <span class="battery-text">100%</span>
        <div class="battery-icon">
          <div class="battery-level" style="width: 100%;"></div>
        </div>
      </div>
    </div>

    <!-- 主屏幕 (Home Screen) -->
    <div id="home-screen" class="screen">
      <div id="home-screen-pages-container">
        <div id="home-screen-pages">
          <div class="home-screen-page">
            <div id="main-content-area">
              
              <!-- 桌面布局 -->
              <div id="desktop-layout">
                <div id="desktop-app-container">
                  
                  <!-- App A 入口 -->
                  <div class="desktop-app-icon" onclick="openApp('a')">
                    <div class="icon-bg-desktop">
                      <img src="https://via.placeholder.com/100/007bff/ffffff?text=A" alt="App A">
                    </div> 
                    <span class="label">应用 A</span>
                  </div>

                  <!-- App B 入口 -->
                  <div class="desktop-app-icon" onclick="openApp('b')">
                    <div class="icon-bg-desktop">
                      <img src="https://via.placeholder.com/100/28a745/ffffff?text=B" alt="App B">
                    </div> 
                    <span class="label">应用 B</span>
                  </div>

                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- App A 页面 -->
    <div id="app-a" class="app-window">
        <div class="app-content" style="background-color: #f0f8ff;">
            <div class="app-header" style="color: #007bff;">应用 A</div>
            <p>这里是 App A 的内容界面。</p>
            <p style="color: #666; font-size: 14px; margin-top: 20px;">点击悬浮球退出</p>
        </div>
    </div>

    <!-- App B 页面 -->
    <div id="app-b" class="app-window">
        <div class="app-content" style="background-color: #f0fff4;">
            <div class="app-header" style="color: #28a745;">应用 B</div>
            <p>这里是 App B 的内容界面。</p>
            <p style="color: #666; font-size: 14px; margin-top: 20px;">点击悬浮球退出</p>
        </div>
    </div>

    <!-- 悬浮按钮 (用于切换/退出) -->
    <div id="floating-btn"></div>

</div>

<script>
    // --- 1. 基础逻辑：时间更新 ---
    function updateTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        document.getElementById('status-bar-time').innerText = `${hours}:${minutes}`;
    }
    setInterval(updateTime, 1000);
    updateTime();

    // --- 2. App 切换逻辑 ---
    const homeScreen = document.getElementById('home-screen');
    const appA = document.getElementById('app-a');
    const appB = document.getElementById('app-b');
    let currentApp = null; // 'a', 'b', or null (home)

    // 打开 App
    function openApp(appId) {
        if (appId === 'a') {
            appA.style.display = 'flex';
            // 强制重绘以触发 transition
            setTimeout(() => appA.classList.add('active'), 10);
            currentApp = 'a';
        } else if (appId === 'b') {
            appB.style.display = 'flex';
            setTimeout(() => appB.classList.add('active'), 10);
            currentApp = 'b';
        }
        
        // 主屏幕视觉上后退一点
        homeScreen.style.transform = 'scale(0.95)';
        homeScreen.style.opacity = '0';
    }

    // 回到桌面 (退出 App)
    function goHome() {
        if (!currentApp) return; // 已经在桌面就不操作

        const activeApp = currentApp === 'a' ? appA : appB;
        
        // 动画隐藏 App
        activeApp.classList.remove('active');
        
        // 动画结束后隐藏 DOM
        setTimeout(() => {
            activeApp.style.display = 'none';
        }, 300);

        // 恢复桌面
        homeScreen.style.transform = 'scale(1)';
        homeScreen.style.opacity = '1';
        
        currentApp = null;
    }

    // --- 3. 悬浮按钮逻辑 (拖拽 + 点击) ---
    const floatBtn = document.getElementById('floating-btn');
    let isDragging = false;
    let startX, startY, initialLeft, initialTop;
    let moveThreshold = 0; // 用于区分点击和拖拽

    // 触摸开始 / 鼠标按下
    function dragStart(e) {
        isDragging = false;
        moveThreshold = 0;
        
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

        startX = clientX;
        startY = clientY;
        
        const rect = floatBtn.getBoundingClientRect();
        // 获取相对于父容器的位置
        initialLeft = floatBtn.offsetLeft;
        initialTop = floatBtn.offsetTop;

        // 绑定移动和结束事件
        if (e.type === 'touchstart') {
            document.addEventListener('touchmove', dragMove, { passive: false });
            document.addEventListener('touchend', dragEnd);
        } else {
            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
        }
    }

    // 拖动中
    function dragMove(e) {
        e.preventDefault(); // 防止页面滚动
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;

        const dx = clientX - startX;
        const dy = clientY - startY;
        
        // 如果移动距离很小，不算拖拽
        moveThreshold += Math.abs(dx) + Math.abs(dy);
        if (moveThreshold > 5) isDragging = true;

        floatBtn.style.left = `${initialLeft + dx}px`;
        floatBtn.style.top = `${initialTop + dy}px`;
        // 清除 right 定位，改用 left
        floatBtn.style.right = 'auto'; 
    }

    // 拖动结束
    function dragEnd() {
        document.removeEventListener('touchmove', dragMove);
        document.removeEventListener('touchend', dragEnd);
        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('mouseup', dragEnd);

        // 如果不是拖拽（即点击），执行功能
        if (!isDragging) {
            handleBtnClick();
        } else {
            // 吸附边缘逻辑 (可选)
            snapToEdge();
        }
    }

    // 简单的吸附边缘动画
    function snapToEdge() {
        const screenWidth = document.body.clientWidth;
        const btnRect = floatBtn.getBoundingClientRect();
        const btnCenter = btnRect.left + btnRect.width / 2;

        floatBtn.style.transition = 'all 0.3s ease';
        
        // 吸附到左右两侧
        if (btnCenter < screenWidth / 2) {
            floatBtn.style.left = '10px';
        } else {
            floatBtn.style.left = (screenWidth - btnRect.width - 10) + 'px';
        }

        // 限制上下边界
        let currentTop = parseFloat(floatBtn.style.top);
        if (currentTop < 50) floatBtn.style.top = '50px';
        if (currentTop > document.body.clientHeight - 80) floatBtn.style.top = (document.body.clientHeight - 80) + 'px';

        // 动画结束后移除 transition 以便下次拖拽更跟手
        setTimeout(() => {
            floatBtn.style.transition = 'opacity 0.3s';
        }, 300);
    }

    // 悬浮球点击逻辑
    function handleBtnClick() {
        // 轻触震动反馈
        if (navigator.vibrate) navigator.vibrate(50);

        if (currentApp) {
            // 如果在 App 里，点击退出
            goHome();
        } else {
            // 如果在桌面，做一个简单的缩放效果表示按下
            floatBtn.style.transform = 'scale(0.8)';
            setTimeout(() => floatBtn.style.transform = 'scale(1)', 100);
        }
    }

    // 绑定事件
    floatBtn.addEventListener('mousedown', dragStart);
    floatBtn.addEventListener('touchstart', dragStart, { passive: false });

</script>
</body>
</html>
